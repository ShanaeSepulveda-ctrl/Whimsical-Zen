<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Fairy's Trail: Sacred Garden</title>
    <style>
        body {
            margin: 0;
            background-color: #050510;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: #ffebcd;
            font-family: "Georgia", serif;
            overflow: hidden;
            touch-action: none;
        }
        #gameContainer {
            position: relative;
            box-shadow: 0 0 100px rgba(100, 200, 255, 0.15);
        }
        canvas {
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            border-radius: 12px;
            display: block;
        }
        #uiLayer {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,1);
            z-index: 10;
        }
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 25px 50px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            z-index: 100;
        }
        #overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 15, 25, 0.98);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            width: 85%;
            max-width: 500px;
            box-shadow: 0 30px 80px rgba(0,0,0,1);
            z-index: 50;
        }
        .btn-group { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; align-items: center; }
        button.action-btn {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            border: none; color: #222; padding: 16px 36px;
            font-weight: bold; font-size: 16px; cursor: pointer; border-radius: 30px; width: 100%;
        }
        button.reset-btn {
            background: transparent; border: 1px solid #666; color: #999;
            padding: 10px 20px; font-size: 14px; cursor: pointer; border-radius: 30px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <button id="startButton">Enter the Garden</button>
        <div id="uiLayer">
            <div id="levelDisplay" style="font-size: 20px; color: #ffd700;">Cycle 1: Awakening</div>
            <div id="scoreDisplay" style="font-size: 14px; opacity: 0.7;">Energy: 0</div>
        </div>
        <div id="overlay">
            <div id="overlayIcon" style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 0 10px white);">ðŸŒ±</div>
            <p id="overlayText" style="font-size: 19px; line-height: 1.6; font-style: italic;">Quote</p>
            <span id="overlayAuthor" style="color: #ffd700; display: block; margin-top: 10px;">- Author</span>
            <div class="btn-group">
                <button id="btnPrimary" class="action-btn" onclick="handlePrimaryBtn()">Absorb Wisdom</button>
                <button id="btnSecondary" class="reset-btn" onclick="handleSecondaryBtn()" style="display:none;">Return to Roots</button>
            </div>
        </div>
    </div>

<script>
    const GRID_SIZE = 20;
    const CHAKRA_COLORS = ["#ff7675", "#fab1a0", "#ffeaa7", "#55efc4", "#74b9ff", "#a29bfe", "#dfe6e9"];
    const LORE_DB = [
        {level: 1, icon: "ðŸ¢", text: "Treat the earth well: it was not given to you by your parents, it was loaned to you by your children.", author: "Native American Proverb"},
        {level: 1, icon: "ðŸŒ²", text: "Adopt the pace of nature: her secret is patience.", author: "Ralph Waldo Emerson"},
        {level: 2, icon: "ðŸŒŠ", text: "Water is the softest thing, yet it can penetrate mountains. This shows the power of persistence.", author: "Lao Tzu"},
        {level: 2, icon: "ðŸ’§", text: "I am a hole in a flute that the Christ's breath moves through â€” listen to this music.", author: "Hafiz"},
        {level: 3, icon: "ðŸ”¥", text: "The soul is dyed the color of its thoughts. Think only on those things that are in line with your principles.", author: "Marcus Aurelius"},
        {level: 4, icon: "ðŸ’š", text: "In the garden of the heart, plant only the flowers of love.", author: "Sufi Wisdom"},
        {level: 5, icon: "ðŸ¦‹", text: "Just when the caterpillar thought the world was over, it became a butterfly.", author: "Anonymous"},
        {level: 6, icon: "ðŸŒŒ", text: "You are not a drop in the ocean. You are the entire ocean in a drop.", author: "Rumi"},
        {level: 7, icon: "âœ¨", text: "We are all just walking each other home.", author: "Ram Dass"}
    ];

    let canvas, ctx, cellSize, snake, direction, nextDirection, food, obstacles = [], particles = [], score = 0, level = 1, isPaused = false, isGameOver = false, isRunning = false, breath = 0;

    window.onload = () => {
        canvas = document.getElementById('gameCanvas');
        ctx = canvas.getContext('2d');
        resize();
        window.addEventListener('resize', resize);
        document.getElementById('startButton').onclick = start;
        document.addEventListener('keydown', key);
        canvas.addEventListener('touchstart', touchS, {passive: false});
        canvas.addEventListener('touchmove', touchM, {passive: false});
    };

    function resize() {
        let s = Math.min(window.innerWidth, window.innerHeight) - 40;
        canvas.width = canvas.height = s;
        cellSize = s / GRID_SIZE;
    }

    function start() {
        document.getElementById('startButton').style.display = 'none';
        isRunning = true;
        reset(1);
        loop();
    }

    function reset(l) {
        level = l; score = (l-1)*150; snake = [{x:10, y:10}]; direction = nextDirection = {x:1, y:0};
        obstacles = []; particles = []; isPaused = isGameOver = false;
        genObs(); spawnF(); updateUI();
        document.getElementById('overlay').style.display = 'none';
    }

    function loop(t) {
        if (!isRunning) return;
        let speed = 5 + (level * 0.4);
        if (t - (loop.last || 0) > 1000/speed) {
            if (!isPaused && !isGameOver) update();
            loop.last = t;
        }
        draw();
        requestAnimationFrame(loop);
    }

    function update() {
        direction = nextDirection;
        let h = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
        if (h.x<0 || h.x>=GRID_SIZE || h.y<0 || h.y>=GRID_SIZE || col(h, snake) || col(h, obstacles)) { gameOver(); return; }
        snake.unshift(h);
        if (h.x === food.x && h.y === food.y) {
            if(food.data) { isPaused = true; show(food.data); score += 50; } else score += 10;
            if(score > level*150) { level++; genObs(); }
            spawnF(); updateUI();
        } else snake.pop();
        particles.push({x: h.x*cellSize+cellSize/2, y: h.y*cellSize+cellSize/2, l: 1, c: `hsl(${Math.random()*360},70%,70%)`});
    }

    function col(p, a) { return a.some(i => i.x === p.x && i.y === p.y); }

    function spawnF() {
        do { food = {x: Math.floor(Math.random()*GRID_SIZE), y: Math.floor(Math.random()*GRID_SIZE)}; } while (col(food, snake) || col(food, obstacles));
        food.data = Math.random() < 0.7 ? LORE_DB.find(l => l.level === level) || LORE_DB[0] : null;
    }

    function genObs() {
        obstacles = []; let c = Math.max(0, (level - 1) * 2);
        for(let i=0; i<c; i++) {
            let o; do { o = {x: Math.floor(Math.random()*GRID_SIZE), y: Math.floor(Math.random()*GRID_SIZE)}; } while (col(o, snake) || Math.abs(o.x-10)+Math.abs(o.y-10) < 6);
            obstacles.push(o);
        }
    }

    function draw() {
        ctx.fillStyle = "#050510"; ctx.fillRect(0,0,canvas.width,canvas.height);
        breath += 0.03;
        // Background
        ctx.strokeStyle = "rgba(255,255,255,0.05)"; ctx.strokeRect(cellSize, cellSize, canvas.width-cellSize*2, canvas.height-cellSize*2);
        // Stones
        ctx.font = cellSize*0.8 + "px serif"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
        obstacles.forEach(o => {
            ctx.shadowBlur = 10 + Math.sin(breath*3)*5; ctx.shadowColor = "red";
            ctx.fillText("ðŸª¨", o.x*cellSize+cellSize/2, o.y*cellSize+cellSize/2);
        });
        // Food
        if(food) {
            ctx.shadowBlur = 20; ctx.shadowColor = "white";
            ctx.fillText(food.data ? food.data.icon : "âœ¨", food.x*cellSize+cellSize/2, food.y*cellSize+cellSize/2);
        }
        // Fairy
        snake.forEach((s, i) => {
            ctx.shadowBlur = 15; ctx.shadowColor = CHAKRA_COLORS[(level-1)%7];
            ctx.fillStyle = i === 0 ? "white" : CHAKRA_COLORS[(level-1)%7];
            ctx.beginPath(); ctx.arc(s.x*cellSize+cellSize/2, s.y*cellSize+cellSize/2, i===0?cellSize/2.2:cellSize/3.5, 0, Math.PI*2); ctx.fill();
            if(i===0) { // Wings
                ctx.strokeStyle = "white"; ctx.lineWidth = 1;
                let f = Math.sin(breath*10)*5;
                ctx.strokeRect(s.x*cellSize, s.y*cellSize+f, cellSize, 2);
            }
        });
        // Particles
        particles.forEach((p, i) => {
            p.l -= 0.02; if(p.l <= 0) particles.splice(i, 1);
            ctx.globalAlpha = p.l; ctx.fillStyle = p.c;
            ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
        });
        ctx.globalAlpha = 1; ctx.shadowBlur = 0;
    }

    function show(d) {
        const o = document.getElementById('overlay');
        document.getElementById('overlayIcon').innerText = d.icon;
        document.getElementById('overlayText').innerText = d.text;
        document.getElementById('overlayAuthor').innerText = "- " + d.author;
        document.getElementById('btnPrimary').innerText = "Absorb Wisdom";
        document.getElementById('btnSecondary').style.display = "none";
        o.style.display = "block";
    }

    function gameOver() {
        isGameOver = true; isPaused = true;
        const o = document.getElementById('overlay');
        document.getElementById('overlayIcon').innerText = "ðŸŒ€";
        document.getElementById('overlayText').innerText = "The cycle turns. Wisdom remains.";
        document.getElementById('overlayAuthor').innerText = "";
        document.getElementById('btnPrimary').innerText = "Reincarnate (Cycle " + level + ")";
        document.getElementById('btnSecondary').style.display = "block";
        o.style.display = "block";
    }

    function handlePrimaryBtn() { if(isGameOver) reset(level); else { isPaused = false; document.getElementById('overlay').style.display = 'none'; } }
    function handleSecondaryBtn() { reset(1); }
    function updateUI() { document.getElementById('levelDisplay').innerText = "Cycle " + level; document.getElementById('scoreDisplay').innerText = "Energy: " + score; }
    function key(e) { if(e.code === "ArrowUp" && direction.y === 0) nextDirection = {x:0, y:-1}; if(e.code === "ArrowDown" && direction.y === 0) nextDirection = {x:0, y:1}; if(e.code === "ArrowLeft" && direction.x === 0) nextDirection = {x:-1, y:0}; if(e.code === "ArrowRight" && direction.x === 0) nextDirection = {x:1, y:0}; }
    let tsx, tsy;
    function touchS(e) { tsx = e.touches[0].clientX; tsy = e.touches[0].clientY; }
    function touchM(e) {
        let dx = e.touches[0].clientX - tsx, dy = e.touches[0].clientY - tsy;
        if(Math.abs(dx) > 15 || Math.abs(dy) > 15) {
            if(Math.abs(dx) > Math.abs(dy)) nextDirection = dx > 0 ? {x:1, y:0} : {x:-1, y:0};
            else nextDirection = dy > 0 ? {x:0, y:1} : {x:0, y:-1};
            tsx = tsy = null;
        }
    }
</script>
</body>
</html>

